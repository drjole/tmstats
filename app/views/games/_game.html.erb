<div class="my-2">
  <%= render(CardComponent.new) do %>
    <details>
      <summary>
        <span>
          <strong><%= l(game.date, format: "%d.%m.%Y") %></strong>
          <%= game.board.name %>
        </span>
        <div>
          <% game.players.count.times do |i| %>
            <% green = "text-green-500" if i == game.players.map(&:user).find_index(Current.user) %>
            <% if i == game.players.map(&:user).find_index(user) %>
              <span class="<%= green %>"><%= user.name.first %></span>
            <% else %>
              <i class="bi bi-person <%= green %>"></i>
            <% end %>
          <% end %>
        </div>
      </summary>

      <p>
        <% if game.num_generations.present? %>
          <%= game.num_generations %>
          <%= "Generation".pluralize(game.num_generations) %>
        <% end %>
      </p>

      <strong>Players:</strong>
      <ul>
        <% game.players.each do |player| %>
          <details>
            <summary>
              <%= player.user.name %>
              <% if player.corporation.present? %>
                (<%= player.corporation.name %>):
              <% end %>
              <strong class="ml-auto"><%= player.victory_points %>
                VP</strong>
            </summary>
            <div class="flex gap-4">
              <div>
                <%= image_tag player.user.profile_picture.variant(:thumb) if player.user.profile_picture.attached? %>
              </div>
              <div class="flex flex-col gap-4">
                <div>
                  <% if policy(player.user).show? %>
                    <%= link_to "Show profile", player.user %>
                  <% end %>
                </div>
              </div>
            </div>
          </details>
        <% end %>
      </ul>

      <% if policy(game).update? %>
        <%= link_to "Edit this game", [:edit, game] %>
      <% end %>
    </details>
  <% end %>
</div>
